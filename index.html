<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Chat estilo WhatsApp</title>

<style>
body{
    margin:0;
    font-family: Arial, sans-serif;
    background:#e5ddd5;
    display:flex;
    flex-direction:column;
    height:100vh;
}

/* Header */
.header{
    background:#075e54;
    color:white;
    padding:15px;
    text-align:center;
    font-weight:bold;
}

/* Chat */
.chat{
    flex:1;
    padding:10px;
    overflow-y:auto;
}

/* Mensajes */
.msg{
  max-width:10%;
  padding:10px;
  margin:8px 0;
  border-radius:8px;
  position:relative;
  word-wrap:break-word;
  display: inline-block; 
}


.left{
    background:white;
    align-self:flex-start;
}

.right{
    background:#dcf8c6;
    align-self:flex-end;
}

/* Flecha */
.left::before{
    content:"";
    position:absolute;
    left:-8px;
    top:10px;
    border-right:8px solid white;
    border-top:8px solid transparent;
    border-bottom:8px solid transparent;
}

.right::after{
    content:"";
    position:absolute;
    right:-8px;
    top:10px;
    border-left:8px solid #dcf8c6;
    border-top:8px solid transparent;
    border-bottom:8px solid transparent;
}

/* BotÃ³n borrar */
.delete{
    position:absolute;
    top:2px;
    right:5px;
    font-size:12px;
    cursor:pointer;
    color:red;
}

/* Input */
.input-area{
    display:flex;
    padding:10px;
    background:#f0f0f0;
}

input{
    flex:1;
    padding:10px;
    border-radius:20px;
    border:1px solid #ccc;
    outline:none;
}

button{
    margin-left:10px;
    padding:10px 15px;
    border:none;
    border-radius:50%;
    background:#25d366;
    color:white;
    font-size:18px;
    cursor:pointer;
}
</style>
</head>

<body>

<div class="header">Chat</div>

<div class="chat" id="chat"></div>

<div class="input-area">
    <input type="text" id="msg" placeholder="Escribe un mensaje">
    <button onclick="send()">âž¤</button>
</div>
<!-- Firebase -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp } 
  from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "TU_API_KEY",
    authDomain: "chat-pwa-2e236.firebaseapp.com",
    projectId: "chat-pwa-2e236",
    storageBucket: "chat-pwa-2e236.appspot.com",
    messagingSenderId: "105304250494",
    appId: "1:105304250494:web:d03f21db9d53fb30f3e02f"
  };

  const app = initializeApp(firebaseConfig);
  window.db = getFirestore(app); // ðŸ‘ˆ IMPORTANTE
</script>
<script>
const chat = document.getElementById("chat");
const messagesRef = collection(db, "Mensajes");

const q = query(messagesRef, orderBy("created"));

onSnapshot(q, (snapshot) => {
  chat.innerHTML = "";
  snapshot.forEach(doc => {
    const data = doc.data();
    addMsg(data.text, data.side);
  });
});
/* Cargar mensajes */

messages.forEach(m => addMsg(m.text, m.side));

async function send(){
  const input = document.getElementById("msg");
  if(input.value.trim() === "") return;

  await addDoc(collection(db, "Mensajes"), {
    text: input.value,
    side: "right",
    created: serverTimestamp()
  });

  input.value = "";
}

    /* Respuesta automÃ¡tica */
    setTimeout(()=>{
        addMsg("Mensaje recibido", "left");
        messages.push();
        save();
    },500);
}

function addMsg(text, side){
    const div = document.createElement("div");
    div.className = "msg " + side;
    div.innerHTML = `<span class="delete">âœ–</span>${text}`;

    div.querySelector(".delete").onclick = ()=>{
        div.remove();
        messages = messages.filter(m => m.text !== text);
        save();
    };

    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
    };

}
</script>

</body>
  </html>
